"use strict";var app={base:{fn:{},vars:{}}};app.base.vars={baseAppUrl:"/",loadedContents:{},loadingClass:"is--loading",visibleClass:"is--visible",htmlNotScrollableClass:"not--scrollable",documentBaseTitle:document.title,pathSlashAlternativeForPartialSlug:"__",contentApiUrlPartialVariable:"PARTIAL",contentApiUrl:"/api/v1/content/{{PARTIAL}}",documentTitleSeperator:" â€” ",probablePageExtensions:[".html"],homepagePartialSlug:"home",currentPagePartialSlug:"{{CURRENT_PAGE}}",modalTemplatePartialSlug:"modal-template",contentTemplatePartialSlug:"content-template",partialSlugDataAttr:"data-partial",partialLoadedDataAttr:"data-partial-loaded",errorCodeTemplate:'<span class="error-code"><strong class="error-code__label">Error Code:</strong><code class="error-code__code">{{ERROR_CODE}}</code></span>',errorCodeVariable:"ERROR_CODE",errorMessageTemplate:'<span class="error-message">{{ERROR_MESSAGE}}</span>',errorMessageVariable:"ERROR_MESSAGE",ajaxTriggerSelector:'a:not([target]):not([href^="#"]):not([disabled]):not([aria-disabled="true"]):not([data-ajax-prevent]),[{{AJAX_ULR_DATA_ATTR}}]',ajaxTriggerSelectorUrlAttrVariable:"AJAX_ULR_DATA_ATTR",ajaxUrlDataAttr:"data-ajax-url",ajaxTargetDataAttr:"data-ajax-target",defaultAjaxError:"Sorry, something wrong occured! :(",emptyResponseAjaxError:"Sorry, nothing received! :(",modalTriggerDataAttr:"data-show-in-modal",modalCloseSelector:"[data-modal-close]",modalTitleDataAttr:"data-modal-title",contentContainerSelector:".content",contentWrapperSelector:".content-body__inner",partialTitleSelector:"[data-partial-title]",partialContentSelector:"[data-partial-content]",modalSelector:".modal",modalFooterSelector:".modal__footer",modalFooterContentSelector:"[data-modal-footer-content]",modalTemplateTitleVariable:"MODAL_TITLE",modalTemplateFooterContentVariable:"MODAL_FOOTER_CONTENT",modalTemplateContentVariable:"MODAL_CONTENT",customContentHeaderSelector:".content__header",customContentBodyTemplateVariable:"CONTENT_BODY",customContentHeaderTemplateVariable:"CONTENT_HEADER"},this.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var a=this,t=(a.parentNode||a.document).querySelectorAll(e),r=-1;t[++r]&&t[r]!=a;);return!!t[r]}}(Element.prototype),app.base.fn={init:function(){app.base.fn.registerEvents(),app.base.fn.fetchLoadableContents()},addEvent:function(e,a,t){e.attachEvent?e.attachEvent("on"+a,t):e.addEventListener(a,t)},live:function(r,e,o,n){app.base.fn.addEvent(n||document,e,function(e){for(var a,t=e.target||e.srcElement;t&&t.matches&&t!==n&&!(a=t.matches(r));)t=t.parentElement;a&&o.call(t,e)})},fetch:function(e,a,t,r,o,n,l){if(e){var s=new XMLHttpRequest;s.open(a||"GET",e),s.setRequestHeader("Content-Type","application/json"),s.onload=function(){var e=s.status,a=s.responseText,t=200<=e&&e-200<100;try{a=JSON.parse(a)}catch(e){}a&&"object"==typeof a&&void 0!==a.success&&(t=a.success),t?"function"==typeof l&&n(a,e):"function"==typeof l&&l(a,e),"function"==typeof r&&r(a,t,e)},s.onerror=function(){"function"==typeof r&&r(app.base.vars.defaultAjaxError,!1,-1),"function"==typeof l&&l(app.base.vars.defaultAjaxError,-1)},"function"==typeof o&&o(s),s.send(encodeURI(JSON.stringify(t&&"object"==typeof t?t:{})))}else"function"==typeof l&&l(app.base.vars.defaultAjaxError,0),"function"==typeof r&&r(app.base.vars.defaultAjaxError,!1,0)},setPageTitle:function(e){document.title=app.base.vars.documentBaseTitle+(e?app.base.vars.documentTitleSeperator+e:"")},setTemplateVariables:function(a,t){return a&&t&&"object"==typeof t&&Object.keys(t).forEach(function(e){a=a.split("{{"+e+"}}").join(t[e]||"")}),a},getPartialSlug:function(a){if(a&&"string"==typeof a){var e=-1!==a.indexOf("/");if(e){var t=document.createElement("a");t.setAttribute("href",a);var r=t.host===document.location.host;a=r?t.pathname:null}if(r||!e){-1!==a.indexOf(app.base.vars.currentPagePartialSlug)&&(a=a.split(app.base.vars.currentPagePartialSlug).join(document.location.pathname));var o=app.base.vars.baseAppUrl;a.substring(0,o.length)===o&&(a=a.substring(o.length,a.length)),app.base.vars.probablePageExtensions.forEach(function(e){a.substr(-1*e.length)===e&&(a=a.substring(0,a.length-e.length))}),a=(a=a.split("/").filter(function(e){return!!e}).join(app.base.vars.pathSlashAlternativeForPartialSlug)).length?a:app.base.vars.homepagePartialSlug}}return a},getContentFromApiResponse:function(e,a){var t=null;if(e)if("string"==typeof e)t=e;else{var r=e.payload&&e.payload.content?e.payload.content:"string"==typeof e.payload&&e.payload.length?e.payload:null;if(r)t=r;else if(a)t=app.base.vars.emptyResponseAjaxError;else{var o=e.error&&e.error.code?e.error.code:e.status,n={};o=(n[app.base.vars.errorCodeVariable]=o)?app.base.fn.setTemplateVariables(app.base.vars.errorCodeTemplate,n):null;var l=e.error&&e.error.message?e.error.message:e.error&&"string"==typeof e.error?e.error:null,s={};l=(s[app.base.vars.errorMessageVariable]=l)?app.base.fn.setTemplateVariables(app.base.vars.errorMessageTemplate,s):null,t=o||l?[o,l].filter(function(e){return!!e}).join("  "):"string"==typeof e.error&&e.error.length?e.error:app.base.vars.defaultAjaxError}}else t=a?app.base.vars.emptyResponseAjaxError:app.base.vars.defaultAjaxError;return t},getContent:function(t,r,e,a){if(t=app.base.fn.getPartialSlug(t)){var o=app.base.vars.loadedContents[t];if(o&&!a)"function"==typeof e&&e(),"function"==typeof r&&r(o,!0,1);else{var n={};n[app.base.vars.contentApiUrlPartialVariable]=t;var l=app.base.fn.setTemplateVariables(app.base.vars.contentApiUrl,n);app.base.fn.fetch(l,"GET",null,function(e,a){(o=app.base.fn.getContentFromApiResponse(e,a))&&a&&(app.base.vars.loadedContents[t]=o),o=o||app.base.vars.defaultAjaxError,"function"==typeof r&&r(o)},e)}}else"function"==typeof r&&r(app.base.vars.defaultAjaxError)},fetchLoadableContents:function(e,a){(e=e instanceof Element||e instanceof HTMLDocument?e:document).querySelectorAll("["+app.base.vars.partialSlugDataAttr+"]"+(a?"":":not(["+app.base.vars.partialLoadedDataAttr+"])")).forEach(function(e){for(var a=document.querySelector(app.base.vars.modalSelector),t=!1,r=e.parentNode;null!=r;){if(r==a){t=!0;break}r=r.parentNode}var o=e.getAttribute(app.base.vars.partialSlugDataAttr);app.base.fn.loadPartial(o,e,null,null,t)})},toggleScrollLock:function(e){var a=document.querySelector("html").classList,t=app.base.vars.htmlNotScrollableClass;null==e&&(e=!(-1!==a.indexOf(t))),e?a.add(t):a.remove(t)},toggleModalVisibility:function(e,a){var t=app.base.vars.visibleClass,r=app.base.vars.loadingClass,o=document.querySelector(app.base.vars.modalSelector);o&&(null==e&&(e=!(-1===o.classList.indexOf(t))),app.base.vars.openModalRequest&&(app.base.vars.openModalRequest.abort(),app.base.vars.openModalRequest=null),!0===e?(a&&(app.base.vars.openModalRequest=a),app.base.fn.toggleScrollLock(!0),o.classList.add(r),o.classList.add(t)):(app.base.fn.toggleScrollLock(!1),o.classList.remove(r),o.classList.remove(t)))},prepareDataFromContent:function(e,a,t){var r=document.createElement("div");r.innerHTML=e;var o=r.querySelector(app.base.vars.partialTitleSelector),n=r.querySelector(app.base.vars.partialContentSelector),l=r.querySelector(app.base.vars.contentWrapperSelector),s=document.querySelector(app.base.vars.modalSelector);if(t=t||(o?o.innerHTML:null),(a=a instanceof Element||a instanceof HTMLDocument?a:document.querySelector(a))===s){var p=app.base.vars.loadedContents[app.base.vars.modalTemplatePartialSlug]||s.parentNode.innerHTML,i=r.querySelector(app.base.vars.modalFooterContentSelector),c=document.createElement("div");if(c.innerHTML=p,c.innerHTML=c.childNodes[0].innerHTML,!i){var d=c.querySelector(app.base.vars.modalFooterSelector);d&&d.remove()}var u={};u[app.base.vars.modalTemplateTitleVariable]=t,u[app.base.vars.modalTemplateContentVariable]=l?l.innerHTML:n?n.innerHTML:e,u[app.base.vars.modalTemplateFooterContentVariable]=i?i.innerHTML:null,e=app.base.fn.setTemplateVariables(c.innerHTML,u)}else if(n||l||a!==document.querySelector(app.base.vars.contentContainerSelector))e=n?n.innerHTML:e;else{var b={},f=document.querySelector("["+app.base.vars.partialSlugDataAttr+'="'+app.base.vars.contentTemplatePartialSlug+'"]'),v=app.base.vars.loadedContents[app.base.vars.contentTemplatePartialSlug]||f&&f.innerHTML,m=r.querySelector(app.base.vars.contentContainerSelector);if(b[app.base.vars.customContentBodyTemplateVariable]=m?m.innerHTML:e,b[app.base.vars.customContentHeaderTemplateVariable]=t,e=app.base.fn.setTemplateVariables(v,b),!t){var g=document.createElement("div");g.innerHTML=e;var T=g.querySelector(app.base.vars.customContentHeaderSelector);T&&T.remove(),e=g.innerHTML}}return{title:t,content:e}},loadPartial:function(r,o,n,l,e){var s=(o=o||app.base.vars.contentContainerSelector)===app.base.vars.modalSelector||e,p=o instanceof Element||o instanceof HTMLDocument?o:document.querySelector(o);if(p){app.base.fn.getContent(r,function(e){if(e){var a=o===app.base.vars.contentContainerSelector;a&&window.scrollTo(0,0);var t=app.base.fn.prepareDataFromContent(e,o,n);e=t.content,n=n||t.title,p.innerHTML=e,a&&app.base.fn.setPageTitle(n),p.setAttribute(app.base.vars.partialLoadedDataAttr,"true"),app.base.fn.fetchLoadableContents(p),"function"==typeof l&&l(p,r,n,e)}else s&&app.base.fn.toggleModalVisibility(!1);p.classList.remove(app.base.vars.loadingClass)},function(e){app.base.fn.toggleModalVisibility(s,e),p.classList.add(app.base.vars.loadingClass),p.removeAttribute(app.base.vars.partialLoadedDataAttr)})}},registerEvents:function(){var e={};e[app.base.vars.ajaxTriggerSelectorUrlAttrVariable]=app.base.vars.ajaxUrlDataAttr;var a=app.base.fn.setTemplateVariables(app.base.vars.ajaxTriggerSelector,e);app.base.fn.live(a,"click",function(e){var a=this,t=a.getAttribute(app.base.vars.ajaxUrlDataAttr)||a.getAttribute("href"),r=document.createElement("a");r.setAttribute("href",t);var o=r.host===document.location.host;if(t&&o){e.preventDefault();var n=a.getAttribute(app.base.vars.modalTriggerDataAttr);n="string"==typeof n&&"false"!==n.toLowerCase();var l=a.getAttribute(app.base.vars.ajaxTargetDataAttr),s=n&&a.getAttribute(app.base.vars.modalTitleDataAttr),p=n?app.base.vars.modalSelector:l||app.base.vars.contentContainerSelector;app.base.fn.loadPartial(t,p,s,function(){window.history&&history.pushState&&p===app.base.vars.contentContainerSelector&&history.pushState({partial:t},"",t)},n)}}),window.addEventListener("popstate",function(e){app.base.fn.loadPartial(document.location.pathname,null,null,function(e,a,t,r){app.base.fn.setPageTitle(t)},!1)}),window.addEventListener("keyup",function(e){"Escape"===e.key&&app.base.fn.toggleModalVisibility(!1)}),app.base.fn.live(app.base.vars.modalCloseSelector,"click",function(e){app.base.fn.toggleModalVisibility(!1)})}},app.base.fn.init();